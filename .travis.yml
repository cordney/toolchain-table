language:
    - objective-c

env:
    - TOOLCHAIN=default
    - TOOLCHAIN=libcxx
    - TOOLCHAIN=clang_libstdcxx
    - TOOLCHAIN=xcode
    - TOOLCHAIN=gcc
    - TOOLCHAIN=ios-nocodesign EXTRA="--iossim"
    - TOOLCHAIN=analyze
    - TOOLCHAIN=sanitize_address

install:
    - brew install cmake
    - brew install python3
    # install cmake toolchains
    - POLLY_VERSION="0.4.4"
    - wget "https://github.com/ruslo/polly/archive/v${POLLY_VERSION}.tar.gz"
    - tar xf "v${POLLY_VERSION}.tar.gz"
    - export POLLY_ROOT="`pwd`/polly-${POLLY_VERSION}"
    - export PATH="${POLLY_ROOT}/bin:${PATH}"
    # -- end
    # install cmake
    - CMAKE_VERSION="3.0.0-rc5_ios-universal"
    - wget "https://github.com/ruslo/CMake/archive/v${CMAKE_VERSION}.tar.gz"
    - openssl sha1 "v${CMAKE_VERSION}.tar.gz"
    - tar xf "v${CMAKE_VERSION}.tar.gz"
    - cd "CMake-${CMAKE_VERSION}"
    -   build.py --install --toolchain default --config Release --fwd "CMAKE_USE_SYSTEM_CURL=YES"
    -   export PATH="`pwd`/_install/default/bin:${PATH}"
    - cd ..
    # -- end
    # verify installed cmake
    - which cmake
    - cmake --version
    # -- end
    # https://github.com/ruslo/polly/wiki/Toolchain-list#ios-nocodesign
    - export XCODE_XCCONFIG_FILE="${POLLY_ROOT}/scripts/NoCodeSign.xcconfig"
    # -- end

script:
    - build.py --toolchain ${TOOLCHAIN} --verbose --test ${EXTRA}
